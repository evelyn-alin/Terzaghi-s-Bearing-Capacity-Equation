<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>承載力計算器（Terzaghi）</title>
  <style>
    :root { --b:#e5e7eb; --bg:#f8fafc; --txt:#0f172a; --mut:#475569; }
    body { font-family: system-ui, -apple-system, "Noto Sans TC", Segoe UI, Arial, sans-serif; margin: 24px; color: var(--txt); }
    h1 { margin: 0 0 10px; font-size: 20px; }
    .note { color: var(--mut); margin: 0 0 16px; line-height: 1.5; }
    .grid { display: grid; grid-template-columns: 1fr; gap: 14px; max-width: 980px; }
    @media (min-width: 920px) { .grid { grid-template-columns: 1fr 1fr; } }
    .card { border: 1px solid var(--b); background: white; border-radius: 12px; padding: 14px; }
    table { width: 100%; border-collapse: collapse; }
    th, td { border: 1px solid var(--b); padding: 8px 10px; text-align: left; }
    th { background: var(--bg); }
    input, select { width: 100%; box-sizing: border-box; padding: 8px 10px; border: 1px solid var(--b); border-radius: 8px; }
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .btns { display: flex; gap: 10px; margin-top: 10px; }
    button { padding: 10px 12px; border: 1px solid var(--b); background: #111827; color: #fff; border-radius: 10px; cursor: pointer; }
    button.secondary { background: white; color: #111827; }
    .small { font-size: 12px; color: var(--mut); }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; }
  </style>
</head>
<body>
  <h1>Terzaghi 基礎極限承載力計算器</h1>
  <p class="note">
    依據你提供的 φ’ 對照表（0~50）自動取得 N<sub>c</sub>, N<sub>q</sub>, N<sub>γ</sub>（此處用 Nγ 表示 Ny），並計算
    <span class="mono">q = γ × D<sub>f</sub></span>，最後得到 <span class="mono">q<sub>u</sub></span>。
    <br>φ’ 若非整數，會在相鄰兩列之間做<strong>線性插值</strong>。
  </p>

  <div class="grid">
    <div class="card">
      <h2 style="margin:0 0 10px;font-size:16px;">輸入參數</h2>

      <div class="row">
        <div>
          <label>基礎型式（係數）</label>
          <select id="shape">
            <option value="strip">一般式 / 條形： qᵤ = c′Nc + qNq + 0.5 γBNγ</option>
            <option value="square">方形： qᵤ = 1.3 c′Nc + qNq + 0.4 γBNγ</option>
            <option value="circular">圓形： qᵤ = 1.3 c′Nc + qNq + 0.3 γBNγ</option>
          </select>
          <div class="small" style="margin-top:6px;">若你只要第一張圖的一般式，選「一般式 / 條形」即可。</div>
        </div>
        <div>
          <label>φ′（度，0~50，可小數）</label>
          <input id="phi" type="number" step="0.1" min="0" max="50"  />
        </div>
      </div>

      <div class="row" style="margin-top:10px;">
        <div>
          <label>B（基礎寬度）</label>
          <input id="B" type="number" step="0.0001"  />
        </div>
        <div>
          <label>D<sub>f</sub>（基礎深度）</label>
          <input id="Df" type="number" step="0.0001"  />
        </div>
      </div>

      <div class="row" style="margin-top:10px;">
        <div>
          <label>c′（有效凝聚力）</label>
          <input id="c" type="number" step="0.0001"/>
        </div>
        <div>
          <label>γ（土壤重度）</label>
          <input id="gamma" type="number" step="0.0001" />
        </div>
      </div>

      <div class="row" style="margin-top:10px;">
        <div>
          <label>q（上覆載重，q = γ × D<sub>f</sub>）</label>
          <input id="q" type="number" step="0.0001" readonly />
          <div class="small" style="margin-top:6px;">此欄位自動計算（如需改成手動輸入，可把 readonly 拿掉）。</div>
        </div>
        <div>
          <label>顯示小數位數</label>
          <input id="digits" type="number" min="0" max="6" step="1"  />
        </div>
      </div>

      <div class="btns">
        <button id="calcBtn">計算</button>
        <button class="secondary" id="resetBtn">重設範例值</button>
      </div>
    </div>

    <div class="card">
      <h2 style="margin:0 0 10px;font-size:16px;">計算結果</h2>

      <table>
        <tbody>
          <tr><th style="width:35%;">φ′</th><td id="o_phi" class="mono">-</td></tr>
          <tr><th>Nc</th><td id="o_Nc" class="mono">-</td></tr>
          <tr><th>Nq</th><td id="o_Nq" class="mono">-</td></tr>
          <tr><th>Nγ</th><td id="o_Ng" class="mono">-</td></tr>
          <tr><th>q = γ × Df</th><td id="o_q" class="mono">-</td></tr>
        </tbody>
      </table>

      <div style="height:10px;"></div>

      <table>
        <thead>
          <tr>
            <th>項目</th>
            <th>公式</th>
            <th>值</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>凝聚力項</td>
            <td id="t1f" class="mono">-</td>
            <td id="t1" class="mono">-</td>
          </tr>
          <tr>
            <td>上覆壓力項</td>
            <td class="mono">q × Nq</td>
            <td id="t2" class="mono">-</td>
          </tr>
          <tr>
            <td>單位重項</td>
            <td id="t3f" class="mono">-</td>
            <td id="t3" class="mono">-</td>
          </tr>
          <tr>
            <th colspan="2">q<sub>u</sub>（極限承載力）</th>
            <th id="qu" class="mono">-</th>
          </tr>
        </tbody>
      </table>

      <div class="small" style="margin-top:10px;" id="interpHint"></div>
    </div>
  </div>

<script>
  // φ' : [Nc, Nq, Nγ]  (依你圖片表 3.1)
  const factors = {
    0:[5.70,1.00,0.00],
    1:[6.00,1.10,0.01],
    2:[6.30,1.22,0.04],
    3:[6.62,1.35,0.06],
    4:[6.97,1.49,0.10],
    5:[7.34,1.64,0.14],
    6:[7.73,1.81,0.20],
    7:[8.15,2.00,0.27],
    8:[8.60,2.21,0.35],
    9:[9.09,2.44,0.44],
    10:[9.61,2.69,0.56],
    11:[10.16,2.98,0.69],
    12:[10.76,3.29,0.85],
    13:[11.41,3.63,1.04],
    14:[12.11,4.02,1.26],
    15:[12.86,4.45,1.52],
    16:[13.68,4.92,1.82],
    17:[14.60,5.45,2.18],
    18:[15.12,6.04,2.59],
    19:[16.56,6.70,3.07],
    20:[17.69,7.44,3.64],
    21:[18.92,8.26,4.31],
    22:[20.27,9.19,5.09],
    23:[21.75,10.23,6.00],
    24:[23.36,11.40,7.08],
    25:[25.13,12.72,8.34],
    26:[27.09,14.21,9.84],
    27:[29.24,15.90,11.60],
    28:[31.61,17.81,13.70],
    29:[34.24,19.98,16.18],
    30:[37.16,22.46,19.13],
    31:[40.41,25.28,22.65],
    32:[44.04,28.52,26.87],
    33:[48.09,32.23,31.94],
    34:[52.64,36.50,38.04],
    35:[57.75,41.44,45.41],
    36:[63.53,47.16,54.36],
    37:[70.01,53.80,65.27],
    38:[77.50,61.55,78.61],
    39:[85.97,70.61,95.03],
    40:[95.66,81.27,115.31],
    41:[106.81,93.85,140.51],
    42:[119.67,108.75,171.99],
    43:[134.58,126.50,211.56],
    44:[151.95,147.74,261.60],
    45:[172.28,173.28,325.34],
    46:[196.22,204.19,407.11],
    47:[224.55,241.80,512.84],
    48:[258.28,287.85,650.67],
    49:[298.71,344.63,831.99],
    50:[347.50,415.14,1072.80]
  };

  const shapeCoeffs = {
    strip:   { kc: 1.0, kg: 0.5, name: "一般式/條形" },
    square:  { kc: 1.3, kg: 0.4, name: "方形" },
    circular:{ kc: 1.3, kg: 0.3, name: "圓形" }
  };

  const $ = (id) => document.getElementById(id);

  function fmt(x, d) {
    if (!isFinite(x)) return "-";
    return Number(x).toFixed(d);
  }

  function lerp(a, b, t) { return a + (b - a) * t; }

  function getFactors(phi) {
    // clamp
    const p = Math.max(0, Math.min(50, phi));
    const lo = Math.floor(p);
    const hi = Math.ceil(p);
    if (lo === hi) {
      return { Nc: factors[lo][0], Nq: factors[lo][1], Ng: factors[lo][2], lo, hi, t: 0 };
    }
    const t = (p - lo) / (hi - lo);
    const [Nc0, Nq0, Ng0] = factors[lo];
    const [Nc1, Nq1, Ng1] = factors[hi];
    return {
      Nc: lerp(Nc0, Nc1, t),
      Nq: lerp(Nq0, Nq1, t),
      Ng: lerp(Ng0, Ng1, t),
      lo, hi, t
    };
  }

  function updateQ() {
    const Df = parseFloat($("Df").value);
    const gamma = parseFloat($("gamma").value);
    const q = (isFinite(Df) && isFinite(gamma)) ? (Df * gamma) : NaN;
    $("q").value = isFinite(q) ? q : "";
  }

  function calc() {
    const B = parseFloat($("B").value);
    const Df = parseFloat($("Df").value);
    const c = parseFloat($("c").value);
    const gamma = parseFloat($("gamma").value);
    const phi = parseFloat($("phi").value);
    const digits = Math.max(0, Math.min(6, parseInt($("digits").value || "3", 10)));



    const q = gamma * Df;
    $("q").value = q;

    const f = getFactors(phi);
    const Nc = f.Nc, Nq = f.Nq, Ng = f.Ng;

    const shape = $("shape").value;
    const { kc, kg, name } = shapeCoeffs[shape];

    const term1 = kc * c * Nc;
    const term2 = q * Nq;
    const term3 = kg * gamma * B * Ng;
    const qu = term1 + term2 + term3;

    $("o_phi").textContent = fmt(phi, digits);
    $("o_Nc").textContent  = fmt(Nc, digits);
    $("o_Nq").textContent  = fmt(Nq, digits);
    $("o_Ng").textContent  = fmt(Ng, digits);
    $("o_q").textContent   = fmt(q, digits);

    $("t1f").textContent = `${fmt(kc, digits)} × c′ × Nc`;
    $("t1").textContent  = fmt(term1, digits);
    $("t2").textContent  = fmt(term2, digits);
    $("t3f").textContent = `${fmt(kg, digits)} × γ × B × Nγ`;
    $("t3").textContent  = fmt(term3, digits);
    $("qu").textContent  = fmt(qu, digits);

    if (f.lo !== f.hi) {
      $("interpHint").textContent =
        `φ′=${phi} 介於 ${f.lo} 與 ${f.hi}，以 t=${fmt(f.t, 4)} 線性插值得到 N 值（基礎型式：${name}）。`;
    } else {
      $("interpHint").textContent =
        `φ′=${f.lo} 直接採用表格列值（基礎型式：${name}）。`;
    }
  }

  function reset() {
    $("shape").value = "strip";
    $("phi").value = 30;
    $("B").value = 2.0;
    $("Df").value = 1.5;
    $("c").value = 10;
    $("gamma").value = 18;
    $("digits").value = 3;
    updateQ();
    calc();
  }

  // events
  ["B","Df","gamma"].forEach(id => $(id).addEventListener("input", updateQ));
  $("calcBtn").addEventListener("click", calc);
  $("resetBtn").addEventListener("click", reset);
  ["phi","shape","c","digits"].forEach(id => $(id).addEventListener("input", calc));

  // init
  updateQ();
  calc();
</script>
</body>
</html>
