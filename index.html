<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Terzaghi 承載力計算器</title>
  <style>
    body{font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans TC","PingFang TC","Microsoft JhengHei",sans-serif; margin:24px; line-height:1.45;}
    h1{font-size:20px; margin:0 0 12px;}
    .card{border:1px solid #ddd; border-radius:12px; padding:16px; margin:12px 0; background:#fff;}
    .grid{display:grid; grid-template-columns:repeat(2, minmax(0,1fr)); gap:12px;}
    label{display:block; font-size:13px; color:#333; margin-bottom:6px;}
    input, select{width:100%; padding:10px 12px; border:1px solid #ccc; border-radius:10px; font-size:14px;}
    input[type="number"]{appearance:textfield;}
    .row{display:flex; gap:12px; flex-wrap:wrap; align-items:flex-end;}
    button{padding:10px 14px; border:0; border-radius:10px; cursor:pointer; font-size:14px;}
    .primary{background:#111; color:#fff;}
    .ghost{background:#f2f2f2; color:#111;}
    .hint{font-size:12px; color:#666; margin-top:8px;}
    .warn{color:#b00020;}
    table{width:100%; border-collapse:collapse; margin-top:10px;}
    th, td{border:1px solid #e3e3e3; padding:10px; text-align:right; font-variant-numeric:tabular-nums;}
    th{text-align:center; background:#fafafa;}
    td:first-child, th:first-child{text-align:left;}
    details{margin-top:10px;}
    summary{cursor:pointer;}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;}
  </style>
</head>
<body>
  <h1>Terzaghi 承載力（使用表 3.1：φ′=0~50）</h1>

  <div class="card">
    <div class="grid">
      <div>
        <label for="B">B（基礎寬度）</label>
        <input id="B" type="number" step="any"  />
      </div>
      <div>
        <label for="D">D（深度）</label>
        <input id="D" type="number" step="any" />
      </div>
      <div>
        <label for="c">c′（凝聚力）</label>
        <input id="c" type="number" step="any" />
      </div>
      <div>
        <label for="g">γ（土壤重量/單位重）</label>
        <input id="g" type="number" step="any"  />
      </div>
      <div>
        <label for="phi">φ′（度，0~50；可輸入小數會做線性內插）</label>
        <input id="phi" type="number" step="any" min="0" max="50"  />
      </div>
      <div>
        <label for="shape">公式</label>
        <select id="shape">
          <option value="strip" selected>條形基礎：qu = c′Nc + qNq + 0.5·γ·B·Ny</option>
          <option value="square">方形基礎：qu = 1.3·c′Nc + qNq + 0.4·γ·B·Ny</option>
          <option value="circle">圓形基礎：qu = 1.3·c′Nc + qNq + 0.3·γ·B·Ny</option>
        </select>
      </div>
    </div>

    <div class="row" style="margin-top:12px;">
      <button class="primary" id="btnCalc">計算</button>
      <button class="ghost" id="btnFillExample" type="button">填入範例值</button>
      <div class="hint">
        q 會依照 <span class="mono">q = D · γ</span> 自動計算（不需要另外輸入 q）。
      </div>
    </div>

    <div id="msg" class="hint"></div>
  </div>

  <div class="card">
    <div class="hint">
      使用承載因素（Nc、Nq、Ny）由表 3.1（φ′=0~50）查得；φ′為小數時採相鄰兩列線性內插。
    </div>

    <table id="resultTable">
      <thead>
        <tr>
          <th>項目</th>
          <th>數值</th>
          <th>說明</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <details>
      <summary>查看 φ′ 對照表（Nc、Nq、Ny）</summary>
      <table id="factorTable">
        <thead>
          <tr><th>φ′</th><th>Nc</th><th>Nq</th><th>Ny</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </details>
  </div>

<script>
/** 表 3.1（φ′=0~50）: [phi, Nc, Nq, Ny] */
const FACTORS = [
  [0, 5.70, 1.00, 0.00],
  [1, 6.00, 1.10, 0.01],
  [2, 6.30, 1.22, 0.04],
  [3, 6.62, 1.35, 0.06],
  [4, 6.97, 1.49, 0.10],
  [5, 7.34, 1.64, 0.14],
  [6, 7.73, 1.81, 0.20],
  [7, 8.15, 2.00, 0.27],
  [8, 8.60, 2.21, 0.35],
  [9, 9.09, 2.44, 0.44],
  [10, 9.61, 2.69, 0.56],
  [11, 10.16, 2.98, 0.69],
  [12, 10.76, 3.29, 0.85],
  [13, 11.41, 3.63, 1.04],
  [14, 12.11, 4.02, 1.26],
  [15, 12.86, 4.45, 1.52],
  [16, 13.68, 4.92, 1.82],
  [17, 14.60, 5.45, 2.18],
  [18, 15.12, 6.04, 2.59],
  [19, 16.56, 6.70, 3.07],
  [20, 17.69, 7.44, 3.64],
  [21, 18.92, 8.26, 4.31],
  [22, 20.27, 9.19, 5.09],
  [23, 21.75, 10.23, 6.00],
  [24, 23.36, 11.40, 7.08],
  [25, 25.13, 12.72, 8.34],
  [26, 27.09, 14.21, 9.84],
  [27, 29.24, 15.90, 11.60],
  [28, 31.61, 17.81, 13.70],
  [29, 34.24, 19.98, 16.18],
  [30, 37.16, 22.46, 19.13],
  [31, 40.41, 25.28, 22.65],
  [32, 44.04, 28.52, 26.87],
  [33, 48.09, 32.23, 31.94],
  [34, 52.64, 36.50, 38.04],
  [35, 57.75, 41.44, 45.41],
  [36, 63.53, 47.16, 54.36],
  [37, 70.01, 53.80, 65.27],
  [38, 77.50, 61.55, 78.61],
  [39, 85.97, 70.61, 95.03],
  [40, 95.66, 81.27, 115.31],
  [41, 106.81, 93.85, 140.51],
  [42, 119.67, 108.75, 171.99],
  [43, 134.58, 126.50, 211.56],
  [44, 151.95, 147.74, 261.60],
  [45, 172.28, 173.28, 325.34],
  [46, 196.22, 204.19, 407.11],
  [47, 224.55, 241.80, 512.84],
  [48, 258.28, 287.85, 650.67],
  [49, 298.71, 344.63, 831.99],
  [50, 347.50, 415.14, 1072.80],
];

function clamp(x, a, b){ return Math.max(a, Math.min(b, x)); }
function fmt(x, d=4){
  if (!Number.isFinite(x)) return "—";
  // 去掉尾端多餘 0
  const s = x.toFixed(d);
  return s.replace(/\.?0+$/,'');
}

/** φ′ 可能是小數：做線性內插 */
function lookupFactors(phi){
  const p = clamp(phi, 0, 50);
  const lo = Math.floor(p);
  const hi = Math.ceil(p);

  const rowLo = FACTORS[lo];
  const rowHi = FACTORS[hi];

  if (lo === hi) {
    return { phi:p, Nc:rowLo[1], Nq:rowLo[2], Ny:rowLo[3], note:`φ′=${lo}（整數列）` };
  }

  const t = (p - lo) / (hi - lo);
  const lerp = (a,b)=> a + (b-a)*t;

  return {
    phi:p,
    Nc: lerp(rowLo[1], rowHi[1]),
    Nq: lerp(rowLo[2], rowHi[2]),
    Ny: lerp(rowLo[3], rowHi[3]),
    note:`φ′=${fmt(p,2)}（介於 ${lo}～${hi}，線性內插）`
  };
}

function getNumber(id){
  const v = Number(document.getElementById(id).value);
  return v;
}

function setMsg(text, isWarn=false){
  const el = document.getElementById("msg");
  el.textContent = text || "";
  el.className = "hint" + (isWarn ? " warn" : "");
}

function renderFactorTable(){
  const tb = document.querySelector("#factorTable tbody");
  tb.innerHTML = FACTORS.map(r => `
    <tr>
      <td style="text-align:left">${r[0]}</td>
      <td>${fmt(r[1],2)}</td>
      <td>${fmt(r[2],2)}</td>
      <td>${fmt(r[3],2)}</td>
    </tr>
  `).join("");
}

function renderResult(rows){
  const tb = document.querySelector("#resultTable tbody");
  tb.innerHTML = rows.map(r => `
    <tr>
      <td>${r.item}</td>
      <td>${r.value}</td>
      <td style="text-align:left">${r.note || ""}</td>
    </tr>
  `).join("");
}

function calc(){
  const B = getNumber("B");
  const D = getNumber("D");
  const c = getNumber("c");
  const g = getNumber("g");
  const phi = getNumber("phi");
  const shape = document.getElementById("shape").value;

  if (![B,D,c,g,phi].every(Number.isFinite)){
    setMsg("請確認所有欄位都輸入數字。", true);
    return;
  }
  if (B <= 0 || D < 0 || g < 0){
    setMsg("B 必須 > 0；D、γ 不可為負。", true);
    return;
  }

  const q = D * g;
  const f = lookupFactors(phi);

  let k_c = 1.0, k_g = 0.5;
  let formulaText = "條形基礎：qu = c′Nc + qNq + 0.5·γ·B·Ny";
  if (shape === "square"){
    k_c = 1.3; k_g = 0.4;
    formulaText = "方形基礎：qu = 1.3·c′Nc + qNq + 0.4·γ·B·Ny";
  } else if (shape === "circle"){
    k_c = 1.3; k_g = 0.3;
    formulaText = "圓形基礎：qu = 1.3·c′Nc + qNq + 0.3·γ·B·Ny";
  }

  const termC = k_c * c * f.Nc;
  const termQ = q * f.Nq;
  const termG = k_g * g * B * f.Ny;
  const qu = termC + termQ + termG;

  setMsg(`已計算完成（${f.note}）。`);

  renderResult([
    { item:"輸入", value:"", note:"" },
    { item:"B", value: fmt(B,6), note:"基礎寬度" },
    { item:"D", value: fmt(D,6), note:"深度" },
    { item:"c′", value: fmt(c,6), note:"凝聚力" },
    { item:"γ", value: fmt(g,6), note:"土壤單位重" },
    { item:"φ′", value: fmt(f.phi,2), note:f.note },

    { item:"由表查得/內插", value:"", note:"" },
    { item:"Nc", value: fmt(f.Nc,6), note:"承載因素" },
    { item:"Nq", value: fmt(f.Nq,6), note:"承載因素" },
    { item:"Ny", value: fmt(f.Ny,6), note:"承載因素" },

    { item:"中間量", value:"", note:"" },
    { item:"q", value: fmt(q,6), note:"q = D · γ" },

    { item:"計算", value:"", note: formulaText },
    { item:"c′Nc（含係數）", value: fmt(termC,6), note:`= ${fmt(k_c,2)} · c′ · Nc` },
    { item:"qNq", value: fmt(termQ,6), note:"= q · Nq" },
    { item:"γ項", value: fmt(termG,6), note:`= ${fmt(k_g,2)} · γ · B · Ny` },

    { item:"結果", value:"", note:"" },
    { item:"qu", value: fmt(qu,6), note:"極限承載力（單位隨輸入而定）" },
  ]);
}

document.getElementById("btnCalc").addEventListener("click", calc);
document.getElementById("btnFillExample").addEventListener("click", () => {
  document.getElementById("B").value = 2;
  document.getElementById("D").value = 1;
  document.getElementById("c").value = 10;
  document.getElementById("g").value = 18;
  document.getElementById("phi").value = 30;
  document.getElementById("shape").value = "strip";
  calc();
});

renderFactorTable();
calc();
</script>
</body>
</html>
